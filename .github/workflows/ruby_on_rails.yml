name: Ruby on Rails

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                rails_version: [5.2.6, 6.1.4]
                ruby_version: [2.5, 2.6, 2.7, '3.0']
                exclude:
                    - rails_version: 5.2.6
                      ruby_version: '3.0'
                include:
                    - rails_version: 7.0.2.3
                      ruby_version: '3.0'
                    - rails_version: 7.0.2.3
                      ruby_version: 3.1
                    - rails_version: 7.0.2.3
                      ruby_version: 3.2
        env:
          RAILS_VERSION: ${{ matrix.rails_version }}
          ON_CI: true
        steps:
            - uses: actions/checkout@v3
            - name: Clear existing lockfile and install dependencies
              run: |
                  rm Gemfile.lock
                  sudo apt-get install libsqlite3-dev
            - name: Set up Ruby
              uses: ruby/setup-ruby@v1
              with:
                  ruby-version: ${{ matrix.ruby_version }}
                  bundler-cache: true
            - name: Build and test with Rake
              run: |
                  bundle exec rake
